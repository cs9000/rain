<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Outlook</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #007bff;
        }
        .days {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            position: relative;
        }
        .day {
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .day1 {
            background: linear-gradient(135deg, #e6f0fa 0%, #d1e3f6 100%);
        }
        .day2 {
            background: linear-gradient(135deg, #e8f5e9 0%, #d4e8d9 100%);
        }
        .day3 {
            background: linear-gradient(135deg, #f3e8ff 0%, #e0d4f2 100%);
        }
        .day h2 {
            margin-top: 0;
            color: #007bff;
        }
        .high {
            font-weight: bold;
            margin-bottom: 20px;
        }
        .period {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .period h3 {
            flex: 1;
            margin: 0;
            font-size: 1em;
        }
        .icon {
            font-size: 2em;
            margin-right: 10px;
        }
        .rain {
            font-size: 0.9em;
            color: #555;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
        .error {
            text-align: center;
            color: #dc3545;
        }
        #debug {
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #debug-toggle {
            display: block;
            margin: 10px auto;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            z-index: 10;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .loading .day {
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <h1>Weather Outlook</h1>
    <div id="error" class="error"></div>
    <div class="days" id="days">
        <div class="loader" id="loader"></div>
        <div class="day day1">
            <h2 id="day1_name">Today</h2>
            <p class="high">High: <span id="day1_high"></span>Â°F</p>
            <div id="day1_morning" class="period">
                <h3>Morning</h3>
                <span id="day1_morning_icon" class="icon"></span>
                <span id="day1_morning_rain" class="rain"></span>
            </div>
            <div id="day1_afternoon" class="period">
                <h3>Afternoon</h3>
                <span id="day1_afternoon_icon" class="icon"></span>
                <span id="day1_afternoon_rain" class="rain"></span>
            </div>
            <div id="day1_evening" class="period">
                <h3>Evening</h3>
                <span id="day1_evening_icon" class="icon"></span>
                <span id="day1_evening_rain" class="rain"></span>
            </div>
        </div>
        <div class="day day2">
            <h2 id="day2_name">Tomorrow</h2>
            <p class="high">High: <span id="day2_high"></span>Â°F</p>
            <div id="day2_morning" class="period">
                <h3>Morning</h3>
                <span id="day2_morning_icon" class="icon"></span>
                <span id="day2_morning_rain" class="rain"></span>
            </div>
            <div id="day2_afternoon" class="period">
                <h3>Afternoon</h3>
                <span id="day2_afternoon_icon" class="icon"></span>
                <span id="day2_afternoon_rain" class="rain"></span>
            </div>
            <div id="day2_evening" class="period">
                <h3>Evening</h3>
                <span id="day2_evening_icon" class="icon"></span>
                <span id="day2_evening_rain" class="rain"></span>
            </div>
        </div>
        <div class="day day3">
            <h2 id="day3_name">Day After</h2>
            <p class="high">High: <span id="day3_high"></span>Â°F</p>
            <div id="day3_morning" class="period">
                <h3>Morning</h3>
                <span id="day3_morning_icon" class="icon"></span>
                <span id="day3_morning_rain" class="rain"></span>
            </div>
            <div id="day3_afternoon" class="period">
                <h3>Afternoon</h3>
                <span id="day3_afternoon_icon" class="icon"></span>
                <span id="day3_afternoon_rain" class="rain"></span>
            </div>
            <div id="day3_evening" class="period">
                <h3>Evening</h3>
                <span id="day3_evening_icon" class="icon"></span>
                <span id="day3_evening_rain" class="rain"></span>
            </div>
        </div>
    </div>
    <button id="debug-toggle">Show Debug Info</button>
    <div id="debug" class="hidden"></div>

    <script>
        function formatDate(date) {
            return date.toISOString().slice(0, 10);
        }

        function getDayName(date) {
            return date.toLocaleString('en-US', { weekday: 'long' });
        }

        function processPeriod(indices, precip, pop, conditions, prefix) {
            const periodDiv = document.getElementById(prefix);
            const iconEl = document.getElementById(prefix + '_icon');
            const rainEl = document.getElementById(prefix + '_rain');

            if (indices.length === 0) {
                periodDiv.classList.add('hidden');
                return;
            }

            let totalPrecip = 0;
            let maxPop = 0;
            let hasRainText = false;
            indices.forEach(i => {
                totalPrecip += precip[i] || 0;
                if (pop[i] > maxPop) maxPop = pop[i] || 0;
                const conditionText = conditions[i]?.text?.toLowerCase() || '';
                if (conditionText.includes('rain') || conditionText.includes('shower') || 
                    conditionText.includes('thunder') || conditionText.includes('drizzle')) {
                    hasRainText = true;
                }
            });

            const isRainy = hasRainText || maxPop >= 10 || totalPrecip >= 0.001;
            iconEl.textContent = isRainy ? 'ðŸŒ§ï¸' : 'â˜€ï¸';
            if (isRainy) {
                rainEl.textContent = `${maxPop}% chance, ${totalPrecip.toFixed(2)} in`;
            } else {
                rainEl.textContent = '';
            }
        }

        function loadWeather() {
            const API_KEY = '7b2406496cd94d9f8ad151853252208'; // Provided WeatherAPI key
            const lat = 27.7125; // Wimauma, FL
            const lon = -82.2987;
            const url = `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${lat},${lon}&days=3&aqi=no&alerts=no`;

            // Show loader
            const daysEl = document.getElementById('days');
            const loaderEl = document.getElementById('loader');
            daysEl.classList.add('loading');

            fetch(url)
                .then(res => {
                    if (!res.ok) throw new Error('API request failed');
                    return res.json();
                })
                .then(data => {
                    // Hide loader
                    daysEl.classList.remove('loading');
                    loaderEl.classList.add('hidden');

                    const now = new Date();
                    const today = new Date(now);
                    const tomorrow = new Date(now);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    const dayAfter = new Date(now);
                    dayAfter.setDate(dayAfter.getDate() + 2);

                    const todayStr = formatDate(today);
                    const tomorrowStr = formatDate(tomorrow);
                    const dayAfterStr = formatDate(dayAfter);

                    const daysData = data.forecast.forecastday;
                    const currentHour = now.getHours();

                    // Debug info
                    let debugInfo = '<h3>Raw API Data</h3>';
                    daysData.forEach((day, idx) => {
                        debugInfo += `<p><strong>${idx === 0 ? 'Today' : idx === 1 ? 'Tomorrow' : getDayName(dayAfter)} (${day.date})</strong></p>`;
                        debugInfo += `<p>Max Temp: ${day.day.maxtemp_f}Â°F</p>`;
                        debugInfo += '<ul>';
                        day.hour.forEach(h => {
                            const hourTime = new Date(h.time);
                            if (hourTime.toISOString().slice(0, 10) >= todayStr) {
                                debugInfo += `<li>${h.time}: ${h.chance_of_rain}% rain, ${h.precip_in} in, Condition: ${h.condition.text}</li>`;
                            }
                        });
                        debugInfo += '</ul>';
                    });
                    document.getElementById('debug').innerHTML = debugInfo;

                    const days = [
                        { str: todayStr, prefix: 'day1', index: 0 },
                        { str: tomorrowStr, prefix: 'day2', index: 1 },
                        { str: dayAfterStr, prefix: 'day3', index: 2 }
                    ];

                    days.forEach(day => {
                        const dayData = daysData[day.index];
                        if (!dayData) {
                            document.getElementById('error').textContent = `No data for ${day.str}`;
                            return;
                        }

                        // Set day names and highs
                        document.getElementById(`${day.prefix}_name`).textContent = day.index === 0 ? 'Today' : day.index === 1 ? 'Tomorrow' : getDayName(dayAfter);
                        const highTemp = dayData.day.maxtemp_f;
                        document.getElementById(`${day.prefix}_high`).textContent = isNaN(highTemp) ? 'N/A' : Math.round(highTemp);

                        const hourly = dayData.hour;
                        let morningIdx = [];
                        let afternoonIdx = [];
                        let eveningIdx = [];

                        hourly.forEach((h, i) => {
                            const hourTime = new Date(h.time);
                            if (hourTime.toISOString().slice(0, 10) === day.str) {
                                const hour = hourTime.getHours();
                                const isCurrentDay = day.str === todayStr;
                                if (isCurrentDay && hour < currentHour) return; // Skip past hours on current day

                                if (hour >= 6 && hour < 12) morningIdx.push(i);
                                else if (hour >= 12 && hour < 18) afternoonIdx.push(i);
                                else if (hour >= 18 && hour < 24) eveningIdx.push(i);
                            }
                        });

                        const precip = hourly.map(h => h.precip_in);
                        const pop = hourly.map(h => h.chance_of_rain);
                        const conditions = hourly.map(h => h.condition);

                        processPeriod(morningIdx, precip, pop, conditions, `${day.prefix}_morning`);
                        processPeriod(afternoonIdx, precip, pop, conditions, `${day.prefix}_afternoon`);
                        processPeriod(eveningIdx, precip, pop, conditions, `${day.prefix}_evening`);
                    });
                })
                .catch(err => {
                    // Hide loader on error
                    daysEl.classList.remove('loading');
                    loaderEl.classList.add('hidden');
                    console.error(err);
                    document.getElementById('error').textContent = 'Failed to load weather data. Please try again later.';
                });
        }

        // Toggle debug info
        document.getElementById('debug-toggle').addEventListener('click', () => {
            const debug = document.getElementById('debug');
            debug.classList.toggle('hidden');
            document.getElementById('debug-toggle').textContent = debug.classList.contains('hidden') ? 'Show Debug Info' : 'Hide Debug Info';
        });

        // Load weather for Wimauma, FL immediately
        loadWeather();
    </script>
</body>
</html>